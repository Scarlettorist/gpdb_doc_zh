<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Composite//EN" "ditabase.dtd">
<topic id="topic1">
    <title id="ke20941">gpload</title>
    <body>
        <p>按照一个YAML格式的控制文件的定义运行一个装载作业。</p>
        <section id="section2">
            <title>概要</title>
            <codeblock><b>gpload</b> <b>-f</b> <varname>control_file</varname> [<b>-l</b> <varname>log_file</varname>] [<b>-h</b> <varname>hostname</varname>] [<b>-p</b> <varname>port</varname>] 
   [<b>-U</b> <varname>username</varname>] [<b>-d</b> <varname>database</varname>] [<b>-W</b>] [<b>--gpfdist_timeout</b> <varname>seconds</varname>] 
   [<b>--no_auto_trans</b>] [[<b>-v</b> | <b>-V</b>] [<b>-q</b>]] [<b>-D</b>]

<b>gpload</b> <b>-?</b> 

<b>gpload</b> <b>--version</b></codeblock>
        </section>
        <section id="section3">
            <title id="ke141293">先决条件</title>
            <p>要执行<codeph>gpload</codeph>命令的客户机必须具有下列要求：</p>
            <ul>
                <li id="ke147914">Python 2.6.2或更新版本，装有<codeph>pygresql</codeph> (Python的PostgreSQL接口包
                    )，和<codeph>pyyaml</codeph>。注意Python及所需的Python库被包含在Greenplum数据库安装包中，
                    因此如果在<codeph>gpload</codeph>运行的机器上安装有Greenplum数据库，用户就不需要单独安装Python。
                    <note>Greenplum数据库的Windows装载客户端仅支持Python 2.5(您可以从<xref href="https://www.python.org"
                            scope="external" format="html"
                    >https://www.python.org</xref>获取)</note>。</li>
                <li id="ke147925"><codeph><xref href="gpfdist.xml#topic1" type="topic"
                    format="dita"/></codeph>并行文件分发程序被安装在<codeph>$PATH</codeph>中。这个程序位于Greenplum
                        数据库的<codeph>$GPHOME/bin</codeph>目录下。
                    </li>
                <li id="ke144650">gpload客户机可以访问（被访问）Greenplum数据库集群（Master和Segments）中所有主机。</li>
                <li id="ke145550">gpload客户及可以访问（被访问）所有可能用来装载数据的主机（ETL服务器）。</li>
            </ul>
        </section>
        <section id="section4">
            <title>描述</title>
            <p><codeph>gpload</codeph>是一个数据装载工具，它扮演着Greenplum数据库外部表并行装载
                特性的接口的角色。通过一个用YAML格式控制文件定义的装载说明，<codeph>gpload</codeph>
                调用Greenplum数据库的并行文件服务器
                (<codeph><xref href="gpfdist.xml" type="topic" format="dita"/></codeph>)执行
                文件装载，基于源数据的定义创建一个外部表定义，并且指定<codeph>INSERT</codeph>、
                <codeph>UPDATE</codeph>或<codeph>MERGE</codeph>操作把源数据装载到数据库中的目标表中。
                <note><codeph>gpfdist</codeph>和<codeph>gpload</codeph>是在Greenplum的主版本级别有效的。
                    例如，Greenplum 4.x版本的<codeph>gpfdist</codeph>不能用于Greenplum 5.x或6.x版本。
                </note>
                <note id="gpload-limitation">如果目标表的列名为保留关键字、有大写字母或包含任何双引号，
                    那么<codeph>MERGE</codeph>和<codeph>UPDATE</codeph>操作不被支持。
                </note></p>
            <p>在目标表上指定多个同时的装载操作时，操作包括在YAML控制文件(控制文件格式见<xref href="#topic1/section7"
                type="section" format="dita"/>)的<codeph>SQL</codeph>集合中指定的任何SQL命令会在单个事务中
                执行以防止数据不一致。
                </p>
        </section>
        <section id="section5">
            <title>选项</title>
            <parml>
                <plentry>
                    <pt>-f <varname>control_file</varname></pt>
                    <pd><b>必选项。</b>包含装载说明详情的YAML文件。请见
                        <xref href="#topic1/section7" type="section" format="dita"/>。</pd>
                </plentry>
                <plentry>
                    <pt>--gpfdist_timeout <varname>seconds</varname></pt>
                    <pd>为<codeph>gpfdist</codeph>并行文件分发程序发送响应设置超时时间。
                        输入一个从<codeph>0</codeph>到<codeph>30</codeph>秒的值（输入"<codeph>0</codeph>"会禁用超时）。
                        注意在高流量网络上可能需要增加这个值。</pd>
                </plentry>
                <plentry>
                    <pt>-l <varname>log_file</varname></pt>
                    <pd>指定在哪里写日志文件。默认是<codeph>~/gpAdminLogs/gpload_<varname>YYYYMMDD</varname></codeph>。
                        有关日志文件的更多信息请见<xref href="#topic1/section9"
                            type="section" format="dita"/>。</pd>
                </plentry>
                <plentry>
                    <pt>--no_auto_trans</pt>
                    <pd>如果用户在目标表上执行单个装载操作，可指定<codeph>--no_auto_trans</codeph>
                        禁用把装载操作作为单个事务处理的特性。
                        </pd>
                    <pd>默认情况下，在一个目标表上执行多个同时的操作时，<codeph>gpload</codeph>把每个装载操作处理为
                        单个事务以防止不一致的数据。
                        </pd>
                </plentry>
                <plentry>
                    <pt>-q (无屏幕输出)</pt>
                    <pd>运行在静默模式中。命令输出不会被显示在屏幕上，但仍将被写入到日志文件。</pd>
                </plentry>
                <plentry>
                    <pt>-D (调试模式)</pt>
                    <pd>检查错误情况，但是不执行装载。</pd>
                </plentry>
                <plentry>
                    <pt>-v (详细模式)</pt>
                    <pd>在装载步骤被执行时，显示它们的详细输出。</pd>
                </plentry>
                <plentry>
                    <pt>-V (非常详细模式)</pt>
                    <pd>显示非常详细的输出。</pd>
                </plentry>
                <plentry>
                    <pt>-? (显示帮助)</pt>
                    <pd>显示帮助，然后退出。</pd>
                </plentry>
                <plentry>
                    <pt>--version</pt>
                    <pd>显示这个工具的版本，然后退出。</pd>
                </plentry>
            </parml>
            <sectiondiv id="section6">
                <b>连接选项</b>
                <parml>
                    <plentry>
                        <pt>-d <varname>database</varname></pt>
                        <pd>要装载到的数据库。如果没有指定，则从装载控制文件、环境变量<codeph>$PGDATABASE</codeph>
                            读取或者默认为当前系统用户名。
                            </pd>
                    </plentry>
                    <plentry>
                        <pt>-h <varname>hostname</varname></pt>
                        <pd>指定Greenplum的Master数据库服务器在其上运行的机器的主机名。如果没有指定，
                            会从装载控制文件、环境变量<codeph>$PGHOST</codeph>读取或者默认为
                            <codeph>localhost</codeph>。
                            </pd>
                    </plentry>
                    <plentry>
                        <pt>-p <varname>port</varname></pt>
                        <pd>指定Greenplum的Master数据库服务器在其上监听连接的TCP端口。如果没有指定，
                            会从装载控制文件、环境变量<codeph>$PGPORT</codeph>读取或者默认为5432。</pd>
                    </plentry>
                    <plentry>
                        <pt>-U <varname>username</varname></pt>
                        <pd>要用其进行连接的数据库角色名。如果没有指定，会从装载控制文件、环境变量<codeph>$PGUSER</codeph>
                            读取或者默认为当前系统用户名。</pd>
                    </plentry>
                    <plentry>
                        <pt>-W (强制口令提示)</pt>
                        <pd>强制口令提示。如果没有指定，会从环境变量<codeph>$PGPASSWORD</codeph>、
                            <codeph>$PGPASSFILE</codeph>指定的口令文件或<codeph>~/.pgpass</codeph>
                            中的口令文件中读取口令。如果这些都没有设置，即使没有提供<codeph>-W</codeph>，
                            <codeph>gpload</codeph>也将提示要求一个口令。</pd>
                    </plentry>
                </parml>
            </sectiondiv>
        </section>
        <section id="section7">
            <title id="ke142495">控制文件格式</title>
            <p><codeph>gpload</codeph>控制文件使用
                <xref
                    href="http://yaml.org/spec/1.1/" scope="external" format="html">YAML 1.1</xref>
                文档格式，然后为定义Greenplum数据库装载操作的多个步骤实现了其自身的模式。
                该控制文件必须是一个有效的YAML文档。</p>
            <p><codeph>gpload</codeph>程序按顺序处理控制文件文档并且使用缩进（空格）来判断文档层次以及
                各个部分之间的关系。空格的使用是有意义的。不能把空格简单地用于格式化目的，并且不能使用制表符。
               </p>
            <p>一个装载控制文件的基础结构是：</p>
            <codeblock>---
<xref href="#topic1/cfversion" format="dita">VERSION</xref>: 1.0.0.1
<xref href="#topic1/cfdatabase" format="dita">DATABASE</xref>: <varname>db_name</varname>
<xref href="#topic1/cfuser" format="dita">USER</xref>: <varname>db_username</varname>
<xref href="#topic1/cfhost" format="dita">HOST</xref>: <varname>master_hostname</varname>
<xref href="#topic1/cfport" format="dita">PORT</xref>: <varname>master_port</varname>
<xref href="#topic1/cfgpload" format="dita">GPLOAD</xref>:
   <xref href="#topic1/cfinput" format="dita">INPUT</xref>:
    - <xref href="#topic1/cfsource" format="dita">SOURCE</xref>:
         <xref href="#topic1/cfsourcelocalname" format="dita">LOCAL_HOSTNAME</xref>:
           - <varname>hostname_or_ip</varname>
         <xref href="#topic1/cfsourceport" format="dita">PORT</xref>: <varname>http_port</varname>
       | <xref href="#topic1/cfversion" format="dita">PORT_RANGE</xref>: [<varname>start_port_range</varname>, <varname>end_port_range</varname>]
         <xref href="#topic1/cfsourcefile" format="dita">FILE</xref>: 
           - <varname>/path/to/input_file</varname>
         <xref href="#topic1/cfsourcessl" format="dita">SSL</xref>: true | false
         <xref href="#topic1/cfsourcecertificatespath" format="dita">CERTIFICATES_PATH</xref>: <varname>/path/to/certificates</varname>
    - <xref href="#topic1/fqdn" format="dita">FULLY_QUALIFIED_DOMAIN_NAME</xref>: true | false
    - <xref href="#topic1/cfcolumns" format="dita">COLUMNS</xref>:
           - <varname>field_name</varname>: <varname>data_type</varname>
    - <xref href="#topic1/cftransform" format="dita">TRANSFORM</xref>: '<varname>transformation</varname>'
    - <xref href="#topic1/cftransformconfig" format="dita">TRANSFORM_CONFIG</xref>: '<varname>configuration-file-path</varname>' 
    - <xref href="#topic1/cfmaxlinelength" format="dita">MAX_LINE_LENGTH</xref>: <varname>integer</varname> 
    - <xref href="#topic1/cfformat" format="dita">FORMAT</xref>: text | csv
    - <xref href="#topic1/cfdelimiter" format="dita">DELIMITER</xref>: '<varname>delimiter_character</varname>'
    - <xref href="#topic1/cfescape" format="dita">ESCAPE</xref>: '<varname>escape_character</varname>' | 'OFF'
    - <xref href="#topic1/cfnullas" format="dita">NULL_AS</xref>: '<varname>null_string</varname>'
    - <xref href="#topic1/cfforcenotnull" format="dita">FORCE_NOT_NULL</xref>: true | false
    - <xref href="#topic1/cfquote" format="dita">QUOTE</xref>: '<varname>csv_quote_character</varname>'
    - <xref href="#topic1/cfheader" format="dita">HEADER</xref>: true | false
    - <xref href="#topic1/cfencoding" format="dita">ENCODING</xref>: <varname>database_encoding</varname>
    - <xref href="#topic1/cferrorlimit" format="dita">ERROR_LIMIT</xref>: <varname>integer</varname>
    - <xref href="#topic1/cferrorlog" format="dita">LOG_ERRORS</xref>: true | false
   <xref href="#topic1/cfexternal" format="dita">EXTERNAL</xref>:
      - <xref href="#topic1/cfschema" format="dita">SCHEMA</xref>: <varname>schema</varname> | '%'
   <xref href="#topic1/cfoutput" format="dita">OUTPUT</xref>:
    - <xref href="#topic1/cftable" format="dita">TABLE</xref>: <varname>schema.table_name</varname>
    - <xref href="#topic1/cfmode" format="dita">MODE</xref>: insert | update | merge
    - <xref href="#topic1/cfmatchcolumns" format="dita">MATCH_COLUMNS</xref>:
           - <varname>target_column_name</varname>
    - <xref href="#topic1/cfupdatecolumns" format="dita">UPDATE_COLUMNS</xref>:
           - <varname>target_column_name</varname>
    - <xref href="#topic1/cfupdatecondition" format="dita">UPDATE_CONDITION</xref>: '<varname>boolean_condition</varname>'
    - <xref href="#topic1/cfmapping" format="dita">MAPPING</xref>:
              <varname>target_column_name</varname>: <varname>source_column_name</varname> | '<varname>expression</varname>'
   <xref href="#topic1/cfpreload" format="dita">PRELOAD</xref>:
    - <xref href="#topic1/cftruncate" format="dita">TRUNCATE</xref>: true | false
    - <xref href="#topic1/cfreusetables" format="dita">REUSE_TABLES</xref>: true | false
    - <xref href="#topic1/cfstagetbl" format="dita">STAGING_TABLE</xref>: <varname>external_table_name</varname>
    - <xref href="#topic1/cffastmatch" format="dita">FAST_MATCH</xref>: true | false
   <xref href="#topic1/cfsql" format="dita">SQL</xref>:
    - <xref href="#topic1/cfbefore" format="dita">BEFORE</xref>: "<varname>sql_command</varname>"
    - <xref href="#topic1/cfafter" format="dita">AFTER</xref>: "<varname>sql_command</varname>"</codeblock>
            <parml>
                <plentry>
                    <pt id="cfversion">VERSION</pt>
                    <pd>可选。<codeph>gpload</codeph>控制文件模式的版本。当前版本是1.0.0.1。</pd>
                </plentry>
                <plentry>
                    <pt id="cfdatabase">DATABASE</pt>
                    <pd>可选。指定Greenplum数据库系统要连接到哪个数据库。如果没有指定则默认为<codeph>$PGDATABASE</codeph>。
                        如果<codeph>$PGDATABASE</codeph>也没有设置，则默认为当前系统用户名。用户还可以在命令行上用
                        <codeph>-d</codeph>选项指定数据库。</pd>
                </plentry>
                <plentry>
                    <pt id="cfuser">USER</pt>
                    <pd>可选。指定用于连接的数据库角色。如果没有指定，默认为当前用户或者<codeph>$PGUSER</codeph>
                        （如果设置）。用户还可以在命令行上用<codeph>-U</codeph>选项指定数据库角色。
                        </pd>
                    <pd>如果运行<codeph>gpload</codeph>的用户不是Greenplum数据库的超级用户，
                        那么必须为该用户授予适当的权限。更多信息请见<cite>Greenplum数据库参考指南</cite>。
                    </pd>
                </plentry>
                <plentry>
                    <pt id="cfhost">HOST</pt>
                    <pd>可选。指定Greenplum数据库的Master主机名。如果没有指定，默认为localhost或者
                        <codeph>$PGHOST</codeph>（如果设置）。用户还可以在命令行上用<codeph>-h</codeph>
                        选项指定Master主机名。</pd>
                </plentry>
                <plentry>
                    <pt id="cfport">PORT</pt>
                    <pd>可选。指定Greenplum数据库的Master端口。如果没有指定，默认为5432或者
                        <codeph>$PGPORT</codeph>（如果设置）。用户还可以在命令行上用<codeph>-p</codeph>
                        选项指定Master端口。</pd>
                </plentry>
                <plentry>
                    <pt id="cfgpload">GPLOAD</pt>
                    <pd>必需。开始装载说明部分。<codeph>GPLOAD</codeph>说明必须定义有一个<codeph>INPUT</codeph>
                        小节和一个<codeph>OUTPUT</codeph>小节。
                        <parml>
                            <plentry>
                                <pt id="cfinput">INPUT</pt>
                                <pd>必需。定义要装载的输入数据的位置和格式。<codeph>gpload</codeph>
                                    将在当前主机上启动<codeph><xref href="gpfdist.xml#topic1"
                                        type="topic" format="dita"/></codeph>文件分布程序的一个或者更多
                                    实例并且在Greenplum数据库中创建指向源数据的外部表定义。注意在其上运行
                                    <codeph>gpload</codeph>的主机必须对所有的Greenplum数据库主机（Master和Segment）
                                    通过网络可访问。
                                    <parml>
                                        <plentry>
                                            <pt id="cfsource">SOURCE</pt>
                                            <pd>必需。<codeph>INPUT</codeph>说明的<codeph>SOURCE</codeph>块定义源文件的位置。
                                                一个<codeph>INPUT</codeph>小节可以定义多个<codeph>SOURCE</codeph>块。每个定义
                                                的<codeph>SOURCE</codeph>块对应于将在本地机器上启动的一个<codeph><xref
                                                    href="gpfdist.xml#topic1" type="topic"
                                                    format="dita"/></codeph>文件分布程序的实例。
                                                每个定义的<codeph>SOURCE</codeph>块必须有一个<codeph>FILE</codeph>说明。
                                                <p>
                                                    更多关于使用<codeph>gpfdist</codeph>并行文件服务器和单个以及多个
                                                    <codeph>gpfdist</codeph>实例的信息，请见<cite>Greenplum数据库管理员指南</cite>
                                                    中的“装载和卸载数据”部分。
                                                  </p><parml>
                                                  <plentry>
                                                  <pt id="cfsourcelocalname">LOCAL_HOSTNAME</pt>
                                                      <pd>可选。指定<codeph>gpload</codeph>运行其上的本地机器
                                                  的主机名或者IP地址。如果这个机器被配置有多个网络接口卡（NICs），
                                                  用户可以指定每块NIC的主机名或者IP，以便允许网络流量同时使用所有的NIC。
                                                  默认是仅使用本地机器的主要主机名或者IP。
                                                 </pd>
                                                  </plentry>
                                                  <plentry>
                                                  <pt id="cfsourceport">PORT</pt>
                                                  <pd>
                                                      可选。指定<codeph><xref href="gpfdist.xml#topic1"
                                                          type="topic" format="dita"/></codeph>
                                                      文件分布程序应该使用的特定端口号。用户还可以提供一个<codeph>PORT_RANGE</codeph>
                                                      来从指定的范围中选择可用的端口。如果<codeph>PORT</codeph>和
                                                      <codeph>PORT_RANGE</codeph>同时被定义，那么<codeph>PORT</codeph>优先。
                                                      如果<codeph>PORT</codeph>和<codeph>PORT_RANGE</codeph>都没有定义，
                                                      默认为在8000和9000之间选择一个可用端口。
                                                 <p>
                                                     如果在<codeph>LOCAL_HOSTNAME</codeph>中声明多个主机名，
                                                     这个端口号被用于所有主机。如果用户想要使用所有的NICs装载一个给定目录位置的同一个
                                                     文件或者文件集合，这种配置就是用户想要的。
                                                  </p></pd>
                                                  </plentry>
                                                  <plentry>
                                                  <pt id="cfsourceportrange">PORT_RANGE</pt>
                                                      <pd>可选。可被用来代替<codeph>PORT</codeph>提供一个端口号范围，
                                                          <codeph>gpload</codeph>可以从其中为这个<codeph><xref href="gpfdist.xml#topic1"
                                                              type="topic" format="dita"/></codeph>
                                                          文件分布程序实例选择一个可用的端口。
                                                      </pd>
                                                  </plentry>
                                                  <plentry>
                                                  <pt id="cfsourcefile">FILE</pt>
                                                      <pd>必需。指定本地文件系统上的一个文件位置、命名管道或者目录位置，
                                                          其中包含要被装载的数据。用户可以声明多于一个文件，
                                                          只要所有指定文件中数据的格式相同。
                                                  <p>如果这些文件被使用<codeph>gzip</codeph>或者<codeph>bzip2</codeph>
                                                      （有<codeph>.gz</codeph>或者<codeph>.bz2</codeph>文件扩展名）压缩，
                                                      这些文件将被自动解压缩（在用户路径中有<codeph>gunzip</codeph>或者
                                                      <codeph>bunzip2</codeph>）。
                                                  </p>
                                                  <p>
                                                      在指定要装载哪些源文件时，用户可以使用通配符（<codeph>*</codeph>）
                                                      或其他C风格的模式匹配来指示多个文件。被指定的文件假定在相对于<codeph>gpload</codeph>
                                                      被执行的当前目录的位置（或者用户可以声明绝对路径）。
                                                  </p></pd>
                                                  </plentry>
                                                  <plentry>
                                                  <pt id="cfsourcessl">SSL</pt>
                                                      <pd>可选。指定<codeph>SSL</codeph>加密的使用。
                                                          如果<codeph>SSL</codeph>被设置为true，<codeph>gpload</codeph>
                                                          用<codeph>--ssl</codeph>启动<codeph>gpfdist</codeph>
                                                          服务器并且使用<codeph>gpfdists://</codeph>协议。
                                                   </pd>
                                                  </plentry>
                                                  <plentry>
                                                  <pt id="cfsourcecertificatespath"
                                                  >CERTIFICATES_PATH</pt>
                                                      <pd>当SSL为<codeph>true</codeph>时必需；
                                                          当SSL为<codeph>false</codeph>或者没有指定时
                                                          不能指定这个参数。<codeph>CERTIFICATES_PATH</codeph>
                                                          中指定的位置必须包含下列文件：
                                                     
                                                 <ul id="ul_azs_eau_mo">
                                                     <li id="ke148142">服务器证书文件
                                                  <codeph>server.crt</codeph></li>
                                                     <li id="ke148143">服务器私钥文件
                                                  <codeph>server.key</codeph></li>
                                                     <li id="ke148144">可信证书授权
                                                         <codeph>root.crt</codeph></li>
                                                 </ul><p>根目录(<codeph>/</codeph>)
                                                     不能被指定为
                                                  <codeph>CERTIFICATES_PATH</codeph>。</p></pd>
                                                  </plentry>
                                                </parml></pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="fqdn">FULLY_QUALIFIED_DOMAIN_NAME</pt>
                                            <pd>可选。指定<codeph>gpload</codeph>是否把主机名解析成完全限定的域名
                                                （FQDN）或者本地主机名。如果值被设置为<codeph>true</codeph>，
                                                名称会被解析到FQDN。如果该值被设置为<codeph>false</codeph>，
                                                则解析到本地主机名。默认是<codeph>false</codeph>。
                                                <p>在某些情况下可能要求一个完全限定的域名。例如，如果Greenplum
                                                    数据库系统在与ETL应用不同的域且该域能够被<codeph>gpload</codeph>访问。
                                                 </p></pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfcolumns">COLUMNS</pt>
                                            <pd>可选。以<codeph><varname>field_name</varname>:<varname>data_type</varname></codeph>
                                                这样的格式指定源数据文件的模式。源文件中的<codeph>DELIMITER</codeph>
                                                字符是分隔两个数据值域（列）的东西。一行由一个换行字符（<codeph>0x0a</codeph>决定）。
                                                <p>如果输入<codeph>COLUMNS</codeph>没有指定，则使用输出<codeph>TABLE</codeph>的模式，
                                                    意味着源数据必须与目标表具有相同的列序、列数以及数据格式。
                                                </p><p>默认的source-to-target映射基于这一节定义的列名与目标<codeph>TABLE</codeph>
                                                    中列名之间的匹配。默认映射可以使用<codeph>MAPPING</codeph>小节覆盖。
                                                    </p></pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cftransform">TRANSFORM</pt>
                                            <pd>可选。指定传递给<codeph>gpload</codeph>的输入转换的名字。
                                                有关XML转换的信息，请见<cite>Greenplum数据库管理员指南</cite>
                                                中的“装载和卸载数据”。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cftransformconfig">TRANSFORM_CONFIG</pt>
                                            <pd>当<codeph>TRANSFORM</codeph>被指定时，这个元素是必需的。
                                                指定在上面<codeph>TRANSFORM</codeph>参数中指定的转换的
                                                配置文件位置。
                                            </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfmaxlinelength">MAX_LINE_LENGTH</pt>
                                            <pd>可选。一个整数，指定传递给<codeph>gpload</codeph>
                                                的XML转换数据中一行的最大长度。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfformat">FORMAT</pt>
                                            <pd>可选。指定源数据文件的格式：纯文本（<codeph>TEXT</codeph>）格式，
                                                逗号分隔值（<codeph>CSV</codeph>）格式。如果没有指定，这个默认为
                                                <codeph>TEXT</codeph>。更多有关源数据格式的信息，请见<cite>
                                                    Greenplum数据库管理员指南</cite>中的“装载和卸载数据”。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfdelimiter">DELIMITER</pt>
                                            <pd>可选。指定在每行数据内分隔列的单个ASCII字符。在TEXT模式中默认是一个制表符，
                                                在CSV模式中默认是一个逗号。用户还可以指定一个非可打印ASCII字符或者非可打印
                                                Unicode字符，例如：<codeph>"\x1B"</codeph>或者<codeph> "\u001B"</codeph>。
                                                对于非可打印字符也支持转义字符串语法<codeph>E'<varname>character-code</varname>'</codeph>。
                                                ASCII或Unicode字符必须被封闭在单引号中。例如：<codeph>E'\x1B'</codeph>或者
                                                <codeph>E'\u001B'</codeph>。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfescape">ESCAPE</pt>
                                            <pd>指定用于C转义序列（例如<codeph>\n</codeph>、<codeph>\t</codeph>、
                                                <codeph>\100</codeph>等等）以及转义可能被当作行列定界符的数据字符的
                                                单个字符。确保选择一个在实际列数据中任何地方都没有使用的转义字符。文本
                                                格式文件的默认转义字符是一个\（反斜线），csv格式文件的默认转义字符是
                                                一个<codeph>"</codeph>（双引号）。不过可以指定另一个字符来表示转义。
                                                还可以在文本格式文件中通过指定<codeph>'OFF'</codeph>值作为转义值来
                                                禁用转义。这对于其中嵌有很多不准备作为转义字符的反斜线的文本格式的Web
                                                日志数据非常有用。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfnullas">NULL_AS</pt>
                                            <pd>可选。指定表示空值的字符串。TEXT模式中默认是<codeph>\N</codeph>
                                                （反斜线-N），<codeph>CSV</codeph>模式中默认是没有引用的空的值。
                                                即便在<codeph>TEXT</codeph>模式中，对于想要把空值与空字符串区分
                                                开来的情况，用户也可以使用空字符串。任何匹配这个字符串的源数据项将
                                                被认为是一个空值。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfforcenotnull">FORCE_NOT_NULL</pt>
                                            <pd>可选。在CSV模式中，处理每个被指定的列，仿佛它被引用并且因此
                                                不是一个NULL值。对于CSV模式中的默认空值字符串（两个定界符之
                                                间什么都没有），这导致缺失的值被计算为长度为零的字符串。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfquote">QUOTE</pt>
                                            <pd>当<codeph>FORMAT</codeph>是<codeph>CSV</codeph>时，
                                                这个元素是必需的。为<codeph>CSV</codeph>模式指定引用
                                                字符。默认是双引号（<codeph>"</codeph>）。
                                            </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfheader">HEADER</pt>
                                            <pd>可选。指定数据文件中的第一行是一个头部行（包含列名）并且不
                                                应被包括在要被装载的数据中。如果使用多个数据源文件，所有的
                                                文件必须有一个头部行。默认是假定输入文件没有头部行。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfencoding">ENCODING</pt>
                                            <pd>可选。源数据的字符集编码。可指定一个字符串常量（例如<codeph>'SQL_ASCII'</codeph>）、
                                                一个整数编码编号，或者指定<codeph>'DEFAULT'</codeph>以使用默认客户端编码。
                                                如果没有指定，默认的客户端编码会被使用。有关支持的字符集的信息，
                                                请见<cite>Greenplum数据库参考指南</cite>。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cferrorlimit">ERROR_LIMIT</pt>
                                            <pd>可选。为这个装载操作启用单行错误隔离模式。当被启用时，
                                                在输入被处理期间只要没有达到错误限制计数，任何Greenplum数据库
                                                Segment会抛弃有格式错误的输入行。如果错误限制没有达到，所有
                                                好的行将会被装载并且任何错误行都将被抛弃或者被捕捉在错误日志
                                                信息中。默认是在遇到第一个错误时中止装载操作。注意单行错误隔离
                                                只适用于有格式错误的数据行，例如有额外或者缺失的属性、有错误
                                                数据类型的属性或者有无效的客户端编码序列。如果遇到约束错误
                                                （例如主键约束）仍将导致装载操作中止。有关处理装载错误的信息，
                                                请见<cite>Greenplum数据库管理员指南</cite>中的“装载和卸载数据”。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cferrorlog">LOG_ERRORS</pt>
                                            <pd>当<codeph>ERROR_LIMIT</codeph>被声明时，这个元素是可选的。
                                                值可以是<codeph>true</codeph>或者<codeph>false</codeph>。
                                                默认值是<codeph>false</codeph>。如果值是<codeph>true</codeph>，
                                                当运行在单行错误隔离模式中时，格式错误的行会被内部记录下来。
                                                用户可以用Greenplum数据库的内建SQL函数<codeph>gp_read_error_log('<varname>table_name</varname>')</codeph>
                                                检查格式错误。如果在装载数据时检测到格式错误，<codeph>gpload</codeph>
                                                会用包含错误信息的表的名字生成一个警告消息，看起来类似于这个消息。
                                                <codeblock><varname>timestamp</varname>|WARN|1 bad row, please use GPDB built-in function gp_read_error_log('<parmname>table-name</parmname>') 
   to access the detailed error row</codeblock></pd>
                                            <pd>如果<codeph>LOG_ERRORS: true</codeph>被指定，必须指定<codeph>REUSE_TABLES: true</codeph>
                                                以便在Greenplum数据库的错误日志中保留格式错误。如果没有指定<codeph>REUSE_TABLES: true</codeph>，
                                                错误信息会在<codeph>gpload</codeph>操作后被删除。只有关于格式错误的总结信息会被返回。
                                                用户可以用Greenplum数据库的函数<codeph>gp_truncate_error_log()</codeph>从错误日志
                                                中删除格式错误。</pd>
                                            <pd>更多有关处理装载错误的信息，请见<cite>Greenplum数据库管理员指南</cite>中的“装载和卸载数据”。
                                                有关<codeph>gp_read_error_log()</codeph>函数的信息，请见<cite>Greenplum数据库参考指南</cite>
                                                中的<codeph>CREATE EXTERNAL TABLE</codeph>命令。
                                              </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfexternal">EXTERNAL</pt>
                                            <pd>可选。定义<codeph>gpload</codeph>创建的外部表数据库对象所属的方案。
                                                </pd>
                                            <pd>默认是使用Greenplum数据库的<codeph>search_path</codeph>。
                                                  </pd>
                                            <pd>
                                                <parml>
                                                  <plentry>
                                                  <pt id="cfschema">SCHEMA</pt>
                                                      <pd>当<codeph>EXTERNAL</codeph>被声明时，这个元素是必需的。
                                                          外部表所在的方案的名称。如果该方案不存在，会返回一个错误。
                                                     </pd>
                                                      <pd>
                                                          如果<codeph>%</codeph>（百分号字符）被指定，
                                                          会使用<codeph>OUTPUT</codeph>小节中<codeph>TABLE</codeph>
                                                          指定的表名的方案。如果这个表名没有指定一个方案，则会使用默认方案。
                                                     </pd>
                                                  </plentry>
                                                </parml>
                                            </pd>
                                        </plentry>
                                    </parml></pd>
                            </plentry>
                            <plentry>
                                <pt id="cfoutput">OUTPUT</pt>
                                <pd>必需。定义要被装载到数据库中的目标表和最终数据列值。
                                    <parml>
                                        <plentry>
                                            <pt id="cftable">TABLE</pt>
                                            <pd>必需。要装载到其中的目标表名。</pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfmode">MODE</pt>
                                            <pd>可选。如果没有指定，则默认为<codeph>INSERT</codeph>。
                                                有三种可用的装载模式：
                                               </pd>
                                            <pd><option>INSERT</option> - 使用下列方法装载数据到目标表中：
                                                <codeblock>INSERT INTO <varname>target_table</varname> SELECT * FROM <varname>input_data</varname>;</codeblock></pd>
                                            <pd><option>UPDATE</option> - 更新目标表中<codeph>MATCH_COLUMNS</codeph>
                                                属性值等于输入数据并且<codeph>UPDATE_CONDITION</codeph>为true（可选条件）
                                                的行的<codeph>UPDATE_COLUMNS</codeph>。如果目标表的列名为保留关键字、
                                                有大写字母或包含双引号（" "），那么不支持<codeph>UPDATE</codeph>。
                                                 </pd>
                                            <pd><option>MERGE</option> - 插入新行并且更新<codeph>FOOBAR</codeph>
                                                属性值等于相应输入数据而且<codeph>MATCH_COLUMNS</codeph>为true
                                                （可选条件）的已有行的<codeph>UPDATE_COLUMNS</codeph>。当源数据
                                                中的<codeph>MATCH_COLUMNS</codeph>值在目标表数据中没有相应值时会
                                                被标识成新行。在那种情况下，源文件中的<b>整个行</b>会被插入，而不仅仅
                                                是<codeph>MATCH</codeph>和<codeph>UPDATE</codeph>列。如果有多个
                                                相等的新<codeph>MATCH_COLUMNS</codeph>值，只有其中一个新行将被插入。
                                                使用<codeph>UPDATE_CONDITION</codeph>可过滤掉要抛弃的行。
                                                如果目标表的列名为保留关键字、
                                                有大写字母或包含双引号（" "），那么不支持<codeph>MERGE</codeph>。
                                                 </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfmatchcolumns">MATCH_COLUMNS</pt>
                                            <pd>如果<codeph>MODE</codeph>为<codeph>UPDATE</codeph>或者
                                                <codeph>MERGE</codeph>，则这个元素是必需的。指定被用作更新
                                                的连接条件的列。对于要在目标表中更新的行，指定目标列中的属性值
                                                必须等于相应的源数据列值。
                                                </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfupdatecolumns">UPDATE_COLUMNS</pt>
                                            <pd>如果<codeph>MODE</codeph>为<codeph>UPDATE</codeph>
                                                或者<codeph>MERGE</codeph>，则这个元素是必需的。指定对
                                                符合<codeph>MATCH_COLUMNS</codeph>条件和可选
                                                <codeph>UPDATE_CONDITION</codeph>的行要更新的列。
                                            </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfupdatecondition">UPDATE_CONDITION</pt>
                                            <pd>可选。指定目标表中要被更新的行（在<codeph>MERGE</codeph>
                                                情况下是要被插入的行）必须满足的一个布尔条件（类似于在
                                                <codeph>WHERE</codeph>子句中声明的那样）。
                                               </pd>
                                        </plentry>
                                        <plentry>
                                            <pt id="cfmapping">MAPPING</pt>
                                            <pd>可选。如果指定一个映射，它会覆盖默认的source-to-target列映射。
                                                默认的source-to-target映射基于源<codeph>COLUMNS</codeph>
                                                小节定义的列名与目标<codeph>TABLE</codeph>中列名之间的匹配。
                                                映射可以被指定为：
                                                </pd>
                                            <pd><codeph><varname>target_column_name</varname>:
                                                  <varname>source_column_name</varname></codeph></pd>
                                            <pd>或者</pd>
                                            <pd><codeph><varname>target_column_name</varname>:
                                                  '<varname>expression</varname>'</codeph></pd>
                                            <pd>其中<varname>expression</varname>是在查询的<codeph>SELECT</codeph>
                                                列表中指定的任意表达式，例如常量值、列引用、操作符调用、函数调用等等。
                                                </pd>
                                        </plentry>
                                    </parml></pd>
                            </plentry>
                        </parml></pd>
                </plentry>
                <plentry>
                    <pt id="cfpreload">PRELOAD</pt>
                    <pd>可选。指定在装载操作之前运行的操作。目前唯一的预装载操作是<codeph>TRUNCATE</codeph>。
                        <parml>
                            <plentry>
                                <pt id="cftruncate">TRUNCATE</pt>
                                <pd>可选。如果设置为true，<codeph>gpload</codeph>将在装载目标表之前
                                    移除其中所有的行。</pd>
                            </plentry>
                            <plentry>
                                <pt id="cfreusetables">REUSE_TABLES</pt>
                                <pd>可选。如果设置为true，<codeph>gpload</codeph>将不会删除它创建的外部表
                                    对象和阶段性对象。这些对象将被重用于未来使用同一装载说明的装载操作。这会
                                    提高小型装载的性能（正在进行的到同一目标表的小型装载）。
                                    </pd>
                                <pd>如果<codeph>LOG_ERRORS: true</codeph>被指定，<codeph>REUSE_TABLES: true</codeph>
                                    必须被指定以保留Greenplum数据库错误日志中的格式错误。如果<codeph>REUSE_TABLES: true</codeph>
                                    没有被指定，格式错误信息会在<codeph>gpload</codeph>操作之后被删除。</pd>
                                <pd>如果<varname>external_table_name</varname>存在，工具会使用存在的表。
                                    如果<codeph>OUTPUT</codeph>表结构与数据库中表结构不吻合，工具会返回错误。
                                </pd>
                            </plentry>
                            <plentry>
                                <pt id="cfstagetbl">STAGING_TABLE</pt>
                                <pd>可选。指定<codeph>gpload</codeph>操作过程中创建的临时外部表的名称。
                                    该外部表会被<codeph>gpfdist</codeph>使用。
                                        <codeph>REUSE_TABLES: true</codeph>必须被指定。如果
                                        <codeph>REUSE_TABLES</codeph>为false或没有指定，
                                        <codeph>STAGING_TABLE</codeph>会被忽略。默认情况下，
                                        <codeph>gpload</codeph>会采用随机名称创建一个临时外部表。</pd>
                                <pd>如果<varname>external_table_name</varname>包含点号(.)，
                                        <codeph>gpload</codeph>会返回错误。如果表已经存在，工具会使用该表。
                                    如果表的结构与<codeph>OUTPUT</codeph>表定义的结构不匹配，工具会返回错误。
                                </pd>
                                <pd>工具会使用<codeph>EXTERNAL</codeph>部分定义的<codeph><xref
                                            href="#topic1/cfschema" format="dita"
                                        >SCHEMA</xref></codeph>值作为
                                    <varname>external_table_name</varname>。如果
                                        <codeph>SCHEMA</codeph>的值为<codeph>%</codeph>，
                                    <varname>external_table_name</varname>的名字会和目标表相同，
                                    <codeph><xref
                                            href="#topic1/cftable" format="dita"
                                        >TABLE</xref></codeph>的表结构与<codeph>OUTPUT</codeph>
                                    部分定义的相同。</pd>
                                <pd>如果没有设置<codeph>SCHEMA</codeph>，工具会在数据库中搜索表
                                    (在<codeph>search_path</codeph>中定义的模式下)，如果找不到该表
                                    ，<varname>external_table_name</varname>表会在<codeph>PUBLIC</codeph>
                                    模式下被创建。</pd>
                            </plentry>
                            <plentry>
                                <pt id="cffastmatch">FAST_MATCH</pt>
                                <pd>可选项。如果设置为true，在重用外部表时，<codeph>gpload</codeph>仅
                                    搜索匹配外部表对象的数据库。工具不会从<codeph>pg_attribute</codeph>
                                    检查外部表的列名和列类型。设置该值可以在重用外部表的前提下提高，
                                    <codeph>gpload</codeph>性能。但是如果实际的列不匹配，该工具会在实际执行
                                    时返回错误</pd>
                                <pd>默认值为false，工具会去预先检查外部表定义的列名和列类型。</pd>
                                <pd><codeph>REUSE_TABLES: true</codeph>也必须被定义。如果
                                        <codeph>REUSE_TABLES</codeph>为false或者没定义，并且
                                        <codeph>FAST_MATCH: true</codeph>被指定，
                                        <codeph>gpload</codeph>会返回告警信息。</pd>
                            </plentry>
                        </parml></pd>
                </plentry>
                <plentry>
                    <pt id="cfsql">SQL</pt>
                    <pd>可选。定义在装载操作之前或者之后要运行的SQL命令。用户可以指定多个<codeph>BEFORE</codeph>
                        或者<codeph>AFTER</codeph>命令。按照想要的执行顺序列出命令。<parml>
                            <plentry>
                                <pt id="cfbefore">BEFORE</pt>
                                <pd>可选。在装载操作开始之前要运行的一个SQL命令。将命令封闭在引号中。</pd>
                            </plentry>
                            <plentry>
                                <pt id="cfafter">AFTER</pt>
                                <pd>可选。在装载操作完成之后要运行的一个SQL命令。将命令封闭在引号中。</pd>
                            </plentry>
                        </parml></pd>
                </plentry>
            </parml>
        </section>
        <section id="section9">
            <title id="ke146419">日志文件格式</title>
            <p><codeph>gpload</codeph>输出的日志文件具有下面的格式：</p>
            <codeblock><varname>timestamp</varname>|<varname>level</varname>|<varname>message</varname></codeblock>
            <p>其中<varname>timestamp</varname>的形式是：<codeph>YYYY-MM-DD
                HH:MM:SS</codeph>，<varname>level</varname>是<codeph>DEBUG</codeph>、
                <codeph>LOG</codeph>、<codeph>INFO</codeph>、<codeph>ERROR</codeph>中间的一个，
                而<varname>message</varname>是普通文本消息。
            </p>
            <p>日志文件中可能让人感兴趣的一些<codeph>INFO</codeph>消息是（其中<varname>#</varname>
                对应于实际的秒数、数据的单位或者失败的行）：
            </p>
            <codeblock>INFO|running time: <varname>#.##</varname> seconds
INFO|transferred <varname>#.#</varname> kB of <varname>#.#</varname> kB.
INFO|gpload succeeded
INFO|gpload succeeded with warnings
INFO|gpload failed
INFO|1 bad row
INFO|<varname>#</varname> bad rows</codeblock>
        </section>
        <section id="section8">
            <title>注解</title>
            <p>如果用户的数据库对象名使用双引号标识符（定界的标识符）创建，用户必须在<codeph>gpload</codeph>
                控制文件中用单引号指定定界的名称。例如，如果用户这样创建一个表：
                </p>
            <codeblock>CREATE TABLE "MyTable" ("MyColumn" text);</codeblock>
            <p>用户的YAML格式的<codeph>gpload</codeph>控制文件应该按如下方式引用上述表和列名：
                </p>
            <codeblock>- COLUMNS:
   - '"MyColumn"': text
OUTPUT:
   - TABLE: public.'"MyTable"'</codeblock>
            <p>如果YAML控制文件包含Greenplum数据库4.3.x的<codeph>ERROR_TABLE</codeph>元素，
                <codeph>gpload</codeph>会提示一个告警，显示表明<codeph>ERROR_TABLE</codeph>
                是不支持的，如果<codeph>LOG_ERRORS</codeph>和<codeph>REUSE_TABLE</codeph>
                被设置为<codeph>true</codeph>，加载错误信息会被正常处理。当运行在单行事务处理模式时，
                格式错误的行会被记录到内部数据库日志。</p>
        </section>
        <section id="section10">
            <title>示例</title>
            <p>按<codeph>my_load.yml</codeph>中的定义运行一个装载作业：</p>
            <codeblock>gpload -f my_load.yml</codeblock>
            <p>装载控制文件的例子：</p>
            <codeblock>---
VERSION: 1.0.0.1
DATABASE: ops
USER: gpadmin
HOST: mdw-1
PORT: 5432
GPLOAD:
   INPUT:
    - SOURCE:
         LOCAL_HOSTNAME:
           - etl1-1
           - etl1-2
           - etl1-3
           - etl1-4
         PORT: 8081
         FILE: 
           - /var/load/data/*
    - COLUMNS:
           - name: text
           - amount: float4
           - category: text
           - descr: text
           - date: date
    - FORMAT: text
    - DELIMITER: '|'
    - ERROR_LIMIT: 25
    - LOG_ERRORS: true
   OUTPUT:
    - TABLE: payables.expenses
    - MODE: INSERT
   PRELOAD:
    - REUSE_TABLES: true 
   SQL:
   - BEFORE: "INSERT INTO audit VALUES('start', current_timestamp)"
   - AFTER: "INSERT INTO audit VALUES('end', current_timestamp)"</codeblock>
        </section>
        <section id="section11">
            <title>另见</title>
            <p><codeph><xref href="gpfdist.xml#topic1" type="topic" format="dita"/></codeph>,
                <cite>Greenplum数据库参考指南</cite>中的<codeph>CREATE EXTERNAL TABLE</codeph>。</p>
        </section>
    </body>
</topic>
